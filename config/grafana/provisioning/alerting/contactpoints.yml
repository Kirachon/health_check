apiVersion: 1

contactPoints:
  - orgId: 1
    name: email-notifications
    receivers:
      - uid: email
        type: email
        settings:
          addresses: admin@example.com
          singleEmail: false
        disableResolveMessage: false

  - orgId: 1
    name: webhook-api
    receivers:
      - uid: webhook
        type: webhook
        settings:
          # Token is expanded from Grafana env var ALERT_WEBHOOK_TOKEN
          url: http://localhost:8001/api/v1/alerts/webhook?token=${ALERT_WEBHOOK_TOKEN}
          httpMethod: POST
        disableResolveMessage: false

policies:
  - orgId: 1
    receiver: webhook-api
    group_by:
      - alertname
      - severity
    group_wait: 30s
    group_interval: 5m
    repeat_interval: 4h
    routes:
      # Critical alerts go to email + webhook
      - receiver: email-notifications
        matchers:
          - severity = critical
        continue: true
        group_wait: 10s
        repeat_interval: 1h

      # Warning alerts only to webhook
      - receiver: webhook-api
        matchers:
          - severity = warning
        group_wait: 30s
        repeat_interval: 4h
