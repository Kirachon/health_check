apiVersion: 1

contactPoints:
  - orgId: 1
    name: email-notifications
    receivers:
      - uid: email
        type: email
        settings:
          addresses: admin@example.com
          singleEmail: false
        disableResolveMessage: false

  - orgId: 1
    name: slack-notifications
    receivers:
      - uid: slack
        type: slack
        settings:
          url: https://hooks.slack.com/services/YOUR/WEBHOOK/URL
          recipient: '#monitoring'
          text: |
            {{ range .Alerts }}
            *Alert:* {{ .Labels.alertname }}
            *Severity:* {{ .Labels.severity }}
            *Device:* {{ .Labels.host_name }}
            *Summary:* {{ .Annotations.summary }}
            *Description:* {{ .Annotations.description }}
            {{ end }}
        disableResolveMessage: false

  - orgId: 1
    name: webhook-api
    receivers:
      - uid: webhook
        type: webhook
        settings:
          url: http://localhost:8000/api/v1/alerts/webhook
          httpMethod: POST
        disableResolveMessage: false

policies:
  - orgId: 1
    receiver: webhook-api
    group_by:
      - alertname
      - severity
    group_wait: 30s
    group_interval: 5m
    repeat_interval: 4h
    routes:
      # Critical alerts go to multiple channels
      - receiver: email-notifications
        matchers:
          - severity = critical
        continue: true
        group_wait: 10s
        repeat_interval: 1h

      - receiver: slack-notifications
        matchers:
          - severity = critical
        continue: true
        group_wait: 10s
        repeat_interval: 1h

      # Warning alerts only to Slack
      - receiver: slack-notifications
        matchers:
          - severity = warning
        group_wait: 30s
        repeat_interval: 4h
